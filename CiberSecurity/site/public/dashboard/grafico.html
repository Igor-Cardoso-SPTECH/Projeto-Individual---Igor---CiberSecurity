<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Exemplo de como Plotar Gráficos</title>
  <!-- Incluindo a biblioteca Chart.js para desenhar gráficos -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="./js/sessao.js"></script>
</head>
<body onload="obterDados()"> <!-- Chamando a função obterDados ao carregar a página -->

<!-- Título para o gráfico de linhas -->
Gráfico de linhas
<div style="width: 800px; background-color: black;">
  <!-- Elemento canvas onde o gráfico de linha será desenhado -->
  <canvas id="linha"></canvas>
  <!-- Elemento canvas onde o gráfico de barra será desenhado -->
  <canvas id="barra"></canvas>
</div>

</body>
</html>

<script>
// Função chamada ao carregar a página para obter e processar os dados
function obterDados(){
  fetch('/usuarios/pontuacaoQuizz')
    .then(function(response){
      return response.json();
    })
    .then(function(data){
      plotarGraficoLinha(data);
    })
    .catch(function(err){
      console.log(err);
    });


    fetch('/usuarios/Registrados')
  .then(function(response){
    return response.json();
  })
  .then(function(data){
    plotarGraficoPizza(data)
    })
  .catch(function(err){
    console.log(err);
  })
}

// Função para plotar o gráfico de linha
function plotarGraficoLinha(dados){
  var pontuacao = [];
  var datas = [];

  for(var i = 0; i < dados.length; i++){
    var dataTratada = dados[i].data.split('T')[0];
    pontuacao.push(dados[i].pontuacao);
    datas.push(dataTratada);
  }

  var ctx = document.getElementById('linha').getContext('2d');
  var myChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: datas,
      datasets: [{
        label: 'pontuacao',
        data: pontuacao,
        backgroundColor: ['#00FF09'],
        borderColor: ['#00FF09'],
        borderWidth: 1
      }]
    }
  });
}


function plotarGraficoPizza(dados){
  
  var unidades = [];
  var perfis = [];

  for (var i = 0; i < dados.length; i++) {
    perfis.push(dados[i].descricao);; // CORRIGIDO AQUI
    unidades.push(dados[i].unidades);
  }

  var ctx = document.getElementById('barra').getContext('2d');

  var cores = ['	#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'];

  var myChart = new Chart(ctx, {
      type: 'pie',
      data: {
          labels: perfis,
          datasets: [{
              data: unidades,
              backgroundColor: cores.slice(0, unidades.length),
              borderColor: '#ffffff',
              borderWidth: 1
          }]
      },
  });
}
</script>
